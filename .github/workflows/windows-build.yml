name: Windows Build (Blender)

on:
  push:
    # Trigger on your feature branch (or add 'main' if you want)
    branches:
      try_custom_cmp_node
  pull_request:
    branches:
      try_custom_cmp_node
  workflow_dispatch:    # Allows manual runs after merge

jobs:
  build:
    runs-on: windows-latest  # GitHub-hosted Windows VM :contentReference[oaicite:7]{index=7}

    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@v4   # Latest checkout 

      - name: 🧰 Install dependencies
        run: choco install -y git cmake python visualstudio2022buildtools  # Chocolatey installs prebuilt packages :contentReference[oaicite:9]{index=9}

      - name: 🛠 Setup MSVC environment
        uses: ilammy/msvc-dev-cmd@v1   # Auto‑locate and configure Developer Command Prompt :contentReference[oaicite:10]{index=10}

      - name: 🏗 Configure Blender build
        run: |
          mkdir build
          cd build
          cmake -G "Visual Studio 17 2022" -A x64 -DCMAKE_BUILD_TYPE=Release ..  # CMake generator for VS 2022 :contentReference[oaicite:11]{index=11}

      - name: 🔨 Build Blender
        run: cmake --build build --config Release -- /m  # Multi‑processor build :contentReference[oaicite:12]{index=12}

      - name: 📦 Upload artifacts
        uses: actions/upload-artifact@v4  # Upgrade to v4 to avoid deprecation errors 
        with:
          name: blender-windows
          path: build/bin/Release
