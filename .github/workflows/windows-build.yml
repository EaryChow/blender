name: Build Windows

on:
  push:
    branches:
      - try_custom_cmp_node

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
        with:
          ref: 'try_custom_cmp_node'

      - name: Set up CMake
        uses: jwlawson/actions-setup-cmake@v1.13.0
        with:
          cmake-version: '3.20.x'

      - name: Update libraries
        run: .\make.bat update

      - name: Build Blender
        run: .\make.bat

      - name: Verify build
        run: |
          if not exist ..\build_windows_Full_x64_vc14_Release\bin\Release\blender.exe (
            echo Blender executable not found
            exit 1
          )

      - name: Upload artifact
        uses: actions/upload-artifact@v3
        with:
          name: blender-windows
          path: ..\build_windows_Full_x64_vc14_Release\bin\Release\blender.exe
